(function(a,b,c){Core.navConfig.logoutUrl="/logout.html";b.extend(Core,{quickInit:function(){var f=b("#searchValue").val().trim()||"";if(f&&f!="请输入电影名称、影院名称、订单号"){var e=b("dt","#form1"),d=e.find("[sk='1']");d.each(function(){var l=b(this),i=l.html(),h=i.toUpperCase().indexOf(f.toUpperCase()),g=f.length;if(i.toUpperCase().indexOf(f.toUpperCase())!=-1){var k=new RegExp(f,"gi");l.html(i.replace(k,"<em class='count'>"+i.substr(h,g)+"</em>"));var j=l.closest("dl");if(l.hasClass("num")&&!j.hasClass("active")){j.addClass("active")}}})}},myInit:function(){b("#otimeInput").iSelect({"":"所有",30:"最近一个月",90:"最近三个月"},function(d){b("#orderTime").val(d.value);b("#form1").submit()});b("#statusInput").iSelect({"":"所有","0":"等待付款","1":"已付款","6":"出票中","2":"出票成功","4":"已退款","5":"已失效"},function(d){b("#orderStatus").val(d.value);b("#form1").submit()});this.focusBlurTip(b("#searchValue"),"请输入电影名称、影院名称、订单号");b(".detail").click(this.showDetail);b(".del").click(this.cancelOrder);b(".resMeg").click(this.rePostMsg).mouseenter(function(){var d=b(this);if(!d.hasClass("resMegDis")){d.parent().addClass("active")}}).mouseleave(function(){if(b(this).hasClass("resMegDis")){return}b(this).parent().removeClass("active")});b("#pagebar").find("a").click(this.pageAclick);b("#form1").submit(function(){var d=b("#searchValue");if(d.val().trim()=="请输入电影名称、影院名称、订单号"){d.val("")}})},showDetail:function(){var d=b(this).closest("dl");if(d.hasClass("active")){d.removeClass("active")}else{d.addClass("active")}},timeFresh:function(l,k,i){if(i&&i==933){var h=14000/15}else{var h=1000}var j=l*h;var g=new Date();var d={};var e=a.setInterval(function(){var n=new Date();var q=n-g;var o=j-q;var f=parseInt(o/60/h);var p=parseInt((o/h)%60);if(f!=d.m){d.m=f;k.html('<em class="timer">'+(d.m<10?("0"+d.m):d.m)+'</em>分<em class="timer">'+(d.s<10?("0"+d.s):d.s)+"</em>")}if(p!=d.s){d.s=p;k.html('<em class="timer">'+(d.m<10?("0"+d.m):d.m)+'</em>分<em class="timer">'+(d.s<10?("0"+d.s):d.s)+"</em>")}if(f==0&&p==0){clearInterval(e);b("#form1").submit()}},100)},cancelOrder:function(){var d=b(this).attr("pid");if(a.confirm("确定要取消订单吗?")){Core.canelOrderPOst(d)}},canelOrderPOst:function(d){Core.post("/movie/close_order.html",{order_id:d},function(f,e){if(!f&&e){e=Core.parseJSON(e);if(e.retcode=="200"){b("#form1").submit()}else{b.dialog({title:"",width:400,css:"iDialogConfirm",button:["*是","否"],content:"<p style='padding:15px 20px;'>非常抱歉，订单删除失败，是否继续尝试!</p>",check:function(g){if(g==1){a.setTimeout(function(){Core.canelOrderPOst(d)},200)}}})}}})},rePostMsg:function(){if(b(this).hasClass("resMegDis")){return}var e=b(this),d=e.attr("pid");e.addClass("resMegDis");Core.post("/movie/resend_message.html",{order_id:d},function(h,g){if(!h&&g){g=Core.parseJSON(g);if(g.retcode=="200"){var f=e.parent();if(g.smsCount>0){e.removeClass("resMegDis");f.find("em").text(g.smsCount)}else{e.unbind();f.removeClass("active")}}else{e.removeClass("resMegDis")}}},"resend")},pageAclick:function(){var d=this.hash.substr(1);if(d){b("#currentPage").val(d);b("#form1").submit()}}})})(window,jQuery);