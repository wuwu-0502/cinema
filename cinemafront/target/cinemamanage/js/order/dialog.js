(function(n,i,k){var D={title:null,content:"",type:"html",width:182,height:0,button:["确定"],css:"",position:"c",method:"append",dragable:1,layout:1,animate:15,timeout:0,init:i.noop,check:i.noop,callback:i.noop},r=n.document,s=i.browser.msie&&i.browser.version<7,h=i.browser.msie,H=0,g={model:10000,modeless:1000},C={},f=function(P,N){var J="iDialog"+P,T=/^\*/,U="",O=s&&!N.layout?'<iframe frameborder="0" class="iFrameGround"/>':"",Q='<table class="iDialogWrapTable"><tr><td class="itd-top-left"></td><td class="itd-top-center"></td><td class="itd-top-right"></td></tr><tr><td class="itd-mid-left"></td><td class="itd-mid-center"><div class="iDialogContent">',S='</div></td><td class="itd-mid-right"></td></tr><tr><td class="itd-bot-left"></td><td class="itd-bot-center"></td><td class="itd-bot-right"></td></tr></table>',R=(N.title===U||N.title===null)?U:'<div class="iDialogHead"><h1>'+N.title+"</h1></div>",K=N.title===null?U:'<a class="iDialogClose" hideFocus="true" href="#"></a>',M=N.button.length==0?U:(function(){var X=['<div class="iDialogFoot">'],W=N.button,Z=W.length,V=0,Y=0;for(;V<Z;V++){X[V+1]='<a href="javascript:;" rel="'+(Z>1?Z-V-1:1)+'" class="iDialogBtn'+(T.test(W[V])&&!Y?(Y++," focusBtn"):U)+'"><span>'+W[V].replace(T,"")+"</span></a>"}X[Z+1]="</div>";return X.join(U)})(),L=['<div class="iDialog',R?"":" iDialogNoTitle",'" style="visibility:hidden;z-index:',N.zindex,'" id="',J,'">',O,Q,R,K,'<div class="iDialogBody"><div class="iDialogMain"></div></div>',M,S,"</div>"].join(U);i(r.body)[N.method](L);return J},q=0,A=function(N,S,R,J){if(!R){return null}var P=r.body,Q=i(n),K=s?i("<iframe frameborder='0' class='iFrameGround fullFrameGround'/>").appendTo(P).css("zIndex",S):null,O=i("<div class='iDialogLayout'></div>").appendTo(P).css("zIndex",S),M=O.css("position").toLowerCase()==="fixed",T=!M||K?Math.max(i(P).outerHeight(),Q.height(),r.documentElement.clientHeight):0,L=K?Math.max(i(P).outerWidth(),r.documentElement.clientWidth):0;if(R<0||q>0){O.addClass("iOpacityZero").mousedown(function(){e(N);return false})}else{if(R==1){q++}}M||O.height(T);if(K){K.width(L).height(T);O.width(L);i(n).unbind("resize",a).resize(a)}return[O,K]},v=function(M,L,J){if(!M){return}L==1&&q--;for(var K=0;K<2;K++){if(M[K]){J?M[K].fadeOut(200,function(){i(this).remove()}):M[K].remove()}}i(n).unbind("resize",a)},e=function(J){var M=i("#"+J),K=0,L=2*6,O=n.setInterval(function(){M[K%2?"removeClass":"addClass"]("iDialogFlash");++K>=L&&n.clearInterval(O)},100)},w=function(J){s&&J.find(".iFrameGround").css("zIndex",-1).width(J.outerWidth()).height(J.outerHeight())},a=function(){s&&i(".fullFrameGround,.iDialogLayout").width(Math.max(i(r.body).outerWidth(),r.documentElement.clientWidth)).height(Math.max(i(r.body).outerHeight(),i(n).height(),r.documentElement.clientHeight))},B=function(O){var N=typeof O==="string"?O:i(O.target).closest(".iDialog")[0].id,L=C,Q=L[N],J,P,M,K=0;if(!Q){return}J=Q.zindex;for(P in L){M=L[P].zindex;if(M<10000&&M>J){i("#"+P).css("zIndex",M-1);K=M>K?M:K;L[P].zindex=M-1}}if(K){i("#"+N).css("zIndex",K);L[N].zindex=K}},p=function(){var K=C,J=0,M,N,L;for(N in K){L=K[N].zindex;M=L>J?(J=L,N):M}return M},d=function(){var J=p();J&&l("#"+J)},l=function(J){if(s&&!r.hasFocus()){return}i(".iDialogBtn[rel=1]",J).focus();i(".focusBtn",J).focus()},c=function(L){if(L&&L.keyCode==27){var K=p(),J=K&&i("#"+K+" .iDialogClose:visible").length;J&&o(K)}},b=false,z=function(){for(var J in C){if(!b){b=true;i(r).keydown(c);return}}b=false;i(r).unbind("keydown",c)},y=n.CollectGarbage||i.noop,j=function(O,K,N,Q){var L,J="iDialogAniCore",P,M=Q||i.noop;if(!N){M.call(O[0]);return}if(N<3){K==1?O.hide()[N==1?"fadeIn":"slideDown"](200,M):O[N==1?"fadeOut":"slideUp"](200,M);return}if(h){O[K==1?"show":"hide"]();M.call(O[0]);return}L="iDialogAnimate"+N;if(K==1){O.addClass(L);n.setTimeout(function(){O.addClass(J);O.removeClass(L);n.setTimeout(function(){O.removeClass(J)},310)},10)}else{O.addClass(J);n.setTimeout(function(){O.addClass(L);n.setTimeout(function(){M.call(O.hide()[0])},325)},1)}},m=function(J){var L=q?-1:1,K={"false":0,"true":L,"-1":-1,0:0,1:L}[J];return K===k?-1:K},u=function(K){var M=K,J=K,L="\v"=="v";if(K>2){M=parseInt(K/10);J=K-10*M}return L?M:J},t=function(K){var J=i(K).eq(0),L="posMark"+ +new Date();if(!J[0]){return null}if(!J[0].orgPosMarkId){J.after("<div style='display:none' id='"+L+"'/>");J[0].orgPosMarkId=L}return J},G=function(N){var O=i.extend({},D,N||{}),J=H++,K,M,Q,L,R,P,S=function(T){var U=n.Core;U&&U.linkAutoClick&&i("a[href*=#Core]",M).unbind("click",U.linkAutoClick).click(U.linkAutoClick);if(L.find("iframe:visible").length){L.append('<div class="iDialogDragLayoutHelper"></div>')}O.init.call(M[0],T)};O.layout=m(O.layout);O.animate=u(O.animate);if(O.layout){O.zindex=++g.model;g.model++;K=f(J,O);O._layout=A(K,O.zindex-1,O.layout,O.animate)}else{O.zindex=g.modeless++;K=f(J,O);O._layout=null}O.returnValue=null;C[K]=O;M=i("#"+K);!O.layout&&M.mousedown(B);Q=i(".iDialogContent",M);L=i(".iDialogMain",M);O.css&&M.addClass(O.css);P=M.css("position");O.width?M.width(O.width):M.addClass("autoWidthDialog");if(O.height){R=L.height()+O.height-M.height();R>0&&L.height(R)}M.css("visibility","visible");switch(O.type){case"html":case"text":L[O.type](O.content);S();break;case"shell":M.html(O.content);S();break;case"frame":M.addClass("iFrameDialog");O.content=O.content+(O.content.indexOf("?")>=0?"&":"?")+"dialogID="+K;L.html('<div class="iFrameLoading">Loading...</div>');i("<iframe scrolling='auto' frameborder='0'/>").addClass("iDialogFrame").insertAfter(L.find(".iFrameLoading")).bind("load",function(){i(".iFrameLoading",L).remove();S(this)}).attr("src",O.content);break;case"ajax":L.html('<div class="iDialogLoading">Loading...</div>').load(O.content,function(V,T,U){var W=true,X=i.safeHTML||function(Y){return Y};T=!V?"error":T;if(T!=="success"&&T!=="notmodified"){M.addClass("iDialogError");L.html("<div>加载远程数据失败（"+(U.status||T)+"）！<br/> URL地址："+X(String(O.content))+"</div>");W=false}M.css(x(O.position,M.width(),M.height(),P));w(M);S(W)});break;case"insert":case"agent":O.orgDom=t(O.content);if(O.orgDom){O.orgDomDisplay=O.orgDom.css("display");(O.type=="insert"?L:M).html(O.orgDom.show());S()}else{delete O.orgDom;L.html("没有找到页面内容（"+O.content+"）请检查！");S()}break}M.css(x(O.position,M.width(),M.height(),P));l(M);z();i(".iDialogBtn",M).click(function(T){var V=i(this).attr("rel"),U=O.check.call(M[0],+V,this);U=U===k?+V:U;if(U!==false){O.returnValue=U;o(K)}T.preventDefault()});i(".iDialogClose",M).click(function(){o(K);return false});if(i.fn.setControlEffect){i(".iDialogClose",M).setControlEffect("iDialogCloseDown");i(".iDialogBtn",M).setControlEffect("iDialogBtnDown")}O.dragable&&E(M,O.dragable);O.timeout&&n.setTimeout(function(){o(K)},O.timeout);w(M);j(M,1,O.animate);return K},o=function(K){if(K){var M=C[K];if(!M){return}var J=M.callback,P=M.returnValue,N=M.orgDom,L=M.orgDomDisplay;if(M.beforeClose&&M.beforeClose(P)===false){return}v(M._layout,M.layout,M.animate);j(i("#"+K),2,M.animate,function(){if(N&&N[0].orgPosMarkId){i("#"+N[0].orgPosMarkId).before(N.css("display",L))}i(this).find("iframe").remove();i(this).hide().empty().remove();try{J(P)}catch(Q){}N=J=P=null;if(s){r.body.className=r.body.className}y()});delete C[K];M=null;d();z();y()}else{for(var O in C){o(O)}}},E=function(P,L){var K=L==2?P:i(".iDialogHead",P),O,J;if(!K[0]||!L||K.css("cursor")=="move"){return}if(!i.fn.bindDrag){alert("缺少拖动组件 $.fn.bindDrag，无法绑定拖动，请联系zjcn5205@126.com")}else{var N=P.css("position").toLowerCase()=="fixed",M=N?function(Q){return{left:Q[0].offsetLeft,top:Q[0].offsetTop}}:function(Q){return Q.offset()};K.css("cursor","move").bindDrag({beforeDrag:function(S){var Q=i(S.target),R;if({input:1,textarea:1,button:1,select:1,options:1,optgroup:1,a:1,object:1,applet:1}[Q[0].tagName.toLowerCase()]||Q.closest("a",this)[0]||Q.closest("button",this)[0]||Q.closest("select",this)[0]||Q.closest("object",this)[0]||(R=Q.closest("label",this),R[0]&&R.attr("for"))){return false}},dragStart:function(Q){O=M(P);J=[Q.pageX,Q.pageY];P.css({marginLeft:"auto",marginTop:"auto",left:O.left,top:O.top,right:"auto",bottom:"auto"});i(".iDialogDragLayoutHelper").show()},onDrag:function(Q){P.css({left:O.left+Q.pageX-J[0],top:O.top+Q.pageY-J[1]})},dragEnd:function(V){var W=M(P),U=i(n),T=[U.width(),U.height()],S=[P.width(),P.height()],R=N?[0,0]:[U.scrollTop(),U.scrollLeft()],Q={};Q.top=Math.max(R[0],Math.min(W.top,T[1]-40+R[0]));Q.left=Math.min(T[0]-40+R[1],Math.max(W.left,60-S[0]+R[1]));if(Q.top!=W.top||Q.left!=W.left){P.animate(Q,200)}i(".iDialogDragLayoutHelper").hide()}})}},F={l:/l/i,t:/t/i,r:/r/i,b:/b/i,c:/c/i},x=function(T,L,X,Q){var K=T.constructor,O={},R=i(n),P=[R.width(),R.height()],V,U,S,N,Y="auto",W=[0,0],M=Q==="fixed",J=F;switch(K){case Array:O.left=T.length>0&&T[0]!==null?T[0]:Y;O.top=T.length>1&&T[1]!==null?T[1]:Y;break;case Number:if(T<0||T>8){break}V=[0,0,P[0],P[1]];U=[V[0],Math.floor((V[2]+V[0]-L)/2),V[2]-L];S=[V[1],Math.floor((V[3]+V[1]-X)/2),V[3]-X];N=[[U[1],S[1]],[U[0],S[0]],[U[1],S[0]],[U[2],S[0]],[U[2],S[1]],[U[2],S[2]],[U[1],S[2]],[U[0],S[2]],[U[0],S[1]]];if(!M){W[0]=R.scrollLeft();W[1]=R.scrollTop()}O.left=N[T][0]+W[0];O.top=Math.max(N[T][1]+W[1],0);break;case String:if(!M){return x(J.t.test(T)?J.l.test(T)?1:J.r.test(T)?3:2:J.b.test(T)?J.l.test(T)?7:J.r.test(T)?5:6:J.c.test(T)?J.l.test(T)?8:J.r.test(T)?4:0:0,L,X,Q)}if(/[^cltbr]/i.test(T)||T.length>2){break}O.left=J.l.test(T)?0:J.r.test(T)?(O.right=0,Y):(O.marginLeft="-"+L/2+"px","50%");O.top=J.t.test(T)?0:J.b.test(T)?(O.bottom=0,Y):(O.marginTop="-"+X/2+"px","50%");break;default:O=T;break}return O},I=/^iDialog\d+$/;i.dialog=function(J,L){if(J===k){return o()}if(typeof J==="string"){if(I.test(J)){if(L){(C[J]||{}).returnValue=L}return o(J)}else{J={content:J}}}else{if(i.isFunction(J)){L=J;J={}}}var K=i.extend({},J||{});if(i.isFunction(L)){K.callback=L}return G(K)};i.extend(i.dialog,{position:function(K,J){if(!K){return}var L="auto",M=i("#"+K),N;if(M[0]){N=i.extend({left:L,top:L,bottom:L,right:L,marginTop:L,marginLeft:L},x(J,M.width(),M.height(),M.css("position")));M.css(N)}},bindDrag:function(J,L){if(!J){return}var M=i("#"+J),N=C[J]||{},K=L||N.dragable||1;if(M[0]){E(M,K);N.dragable=K}},unbindDrag:function(J){if(!J){return}var L=i("#"+J),K=L.find(".iDialogHead"),M=C[J]||{};if(L[0]){(M.dragable==2?L:K).unbind("mousedown").css("cursor","");if(M.dragable==2&&!M.layout){L.mousedown(B)}}},_cache:function(J){return J?C[J]||{}:{}}})})(window,jQuery);